apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: participants
  namespace: kube-system
spec:
  generators:
  - list:
    elements:
    - namespace: tom
      participant:
      participant_name: tom
      participant_email: tom@skyworkz.cloud
    - namespace: leonardo
      participant_name: leonardo
      participant_email: leonardo@skyworkz.cloud
    - namespace: robert
      participant_name: robert
      participant_email: robert@skyworkz.cloud
  template:
    metadata:
      name: 'participant-{{participant_name}}'
      namespace: kube-system
    spec:
      project: default
      source:
        repoURL: https://github.com/skyworkz/kubernetes-training-setup-aws.git
        targetRevision: main
        path: kubernetes/participant
        helm:
          values: |
            namespace: '{{namespace}}'
            participant.name: '{{participant_name}}'
            participant.email: '{{participant_email}}'
            trainers: {{ .Values.trainers }}
      destination:
        server: "https://kubernetes.default.svc"
        namespace: kube-system
      syncPolicy:
        automated:
          selfHeal: true
          prune: true
      syncOptions:
      - CreateNamespace=true
    ```